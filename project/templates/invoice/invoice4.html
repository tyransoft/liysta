<!DOCTYPE html>
{% load static %}
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>فاتورة رقم -{{bill.id}}-{{bill.ordernumber}}</title>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }
    
    body {
      font-family: sans-serif;
      background: #ffffff;
      color: #222222;
      line-height: 1.5;
      font-size: 12px;
      padding: 10px;
      direction: rtl;
    }
    
    .invoice-container {
      max-width: 210mm;
      min-height: 297mm;
      margin: 0 auto;
      padding: 15mm;
      background: #ffffff;
    }
    
    .logo-section {
      margin-bottom: 15px;
      padding-bottom: 12px;
      border-bottom: 2px solid #1a1a1a;
      text-align: center;
    }
    
    .logo-img {
      width: 100px;
      height: auto;
      max-height: 60px;
      object-fit: contain;
      margin-bottom: 8px;
    }
    
    .logo-text {
      font-size: 18px;
      font-weight: 800;
      color: #1a1a1a;
    }
    
    .company-client-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 15px;
      padding: 12px;
      background: #f5f5f5;
      border-radius: 5px;
      border-right: 3px solid #2c5282;
      font-size: 11px;
    }
    
    .info-section {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .info-label {
      font-size: 13px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 2px;
      padding-bottom: 1px;
      border-bottom: 1px solid #cccccc;
    }
    
    .info-value {
      font-size: 11px;
      color: #222222;
      line-height: 1.4;
    }
    
    .invoice-details {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 12px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 4px;
      border: 1px solid #cccccc;
      font-size: 11px;
    }
    
    .invoice-number {
      font-size: 16px;
      font-weight: 800;
      color: #2c5282;
    }
    
    .date-section {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .date-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .date-label {
      font-size: 11px;
      color: #666666;
    }
    
    .date-value {
      font-size: 11px;
      font-weight: 600;
      color: #222222;
    }
    
    .divider {
      height: 1px;
      background: #1a1a1a;
      margin: 15px 0;
    }
    
    .items-section {
      margin: 15px 0;
    }
    
    .section-title {
      font-size: 16px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 12px;
      text-align: center;
    }
    
    .pricing-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      border-radius: 4px;
      overflow: hidden;
      font-size: 10px;
    }
    
    .pricing-table thead {
      background: #1a1a1a;
      color: white;
    }
    
    .pricing-table th {
      padding: 8px 6px;
      font-weight: 600;
      text-align: center;
      font-size: 10px;
    }
    
    .pricing-table tbody tr {
      border-bottom: 1px solid #cccccc;
    }
    
    .pricing-table tbody tr:nth-child(even) {
      background-color: #fafafa;
    }
    
    .pricing-table td {
      padding: 6px 4px;
      text-align: center;
      vertical-align: middle;
      font-size: 10px;
    }
    
    .service-name {
      text-align: right;
      font-weight: 500;
      padding-right: 8px;
    }
    
    .quantity, .unit-price, .subtotal {
      direction: ltr;
      font-weight: 500;
    }
    
    .col-no { width: 6%; }
    .col-service { width: 49%; }
    .col-quantity { width: 12%; }
    .col-unit { width: 15%; }
    .col-subtotal { width: 15%; }
    
    .total-section {
      margin-top: 15px;
      display: flex;
      justify-content: flex-end;
    }
    
    .total-box {
      width: 220px;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 5px;
      border: 1px solid #2c5282;
      font-size: 11px;
    }
    
    .total-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px dashed #cccccc;
    }
    
    .total-row:last-child {
      border-bottom: none;
      border-top: 1px solid #1a1a1a;
      margin-top: 6px;
      padding-top: 8px;
    }
    
    .total-label {
      font-size: 12px;
      font-weight: 600;
      color: #1a1a1a;
    }
    
    .total-value {
      font-size: 12px;
      font-weight: 700;
      color: #1a1a1a;
      direction: ltr;
    }
    
    .total-amount .total-label {
      font-size: 13px;
      font-weight: 800;
    }
    
    .total-amount .total-value {
      font-size: 14px;
      font-weight: 800;
      color: #2c5282;
    }
    
    .invoice-footer {
      margin-top: 25px;
      padding-top: 12px;
      border-top: 1px solid #cccccc;
      text-align: center;
      color: #666666;
      font-size: 10px;
    }
    
    .controls {
      margin-top: 20px;
      padding: 12px;
      background: #f5f5f5;
      border-radius: 5px;
      display: flex;
      justify-content: center;
      gap: 12px;
    }
    
    .btn {
      padding: 8px 20px;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      min-width: 130px;
      text-align: center;
    }
    
    .btn-print {
      background: #1a1a1a;
      color: white;
    }
    
    .btn-back {
      background: white;
      color: #1a1a1a;
      border: 1px solid #cccccc;
    }
    
    @media print {
      @page {
        size: A4 portrait;
        margin: 15mm;
      }
      
      body {
        padding: 0;
        background: white;
        margin: 0;
      }
      
      .invoice-container {
        box-shadow: none;
        margin: 0 auto;
        padding: 0;
        max-width: 100%;
        min-height: auto;
      }
      
      .controls {
        display: none;
      }
      
      .logo-img {
        width: 80px;
      }
      
      .pricing-table {
        font-size: 9px;
        page-break-inside: avoid;
      }
      
      .pricing-table th,
      .pricing-table td {
        padding: 5px 3px;
      }
    }
    
    .currency {
      margin: 0 1px;
      font-size: 9px;
    }
    
    .row-number {
      font-weight: 600;
      color: #666666;
    }
  </style>
</head>
<body>
  
  <div class="invoice-container">
    
    <div class="logo-section">
      <img src="{{bill.menu.logo.url}}" alt="شعار الشركة" class="logo-img">
      <div class="logo-text">{{ bill.menu.customer.store_ar_name}}</div>
    </div>
    
    <div class="company-client-info">
      <div class="info-section">
        <div class="info-label">من:</div>
        <div class="info-value">
          <strong>{{ bill.menu.customer.store_ar_name}}</strong><br>
           <br>
          هاتف:   {{ bill.menu.customer.phone}} <br>
        </div>
      </div>
      
      <div class="info-section">
        <div class="info-label">إلى:</div>
        <div class="info-value">
          <strong>{{ bill.customer_name}}</strong> <br>
                 هاتف: {{ bill.customer_phone }}<br>
                {% if bill.delivery_address %}
                   طريقة الاستلام: توصيل <br>

                  العنوان: {{ bill.delivery_address.name }}<br>
                {% elif bill.company_delivery_city %}
                   طريقة الاستلام: توصيل <br>

                  العنوان: {{ bill.company_delivery_city }}<br>
                {% else %}
                  طريقة الاستلام: استلام من المحل<br>
                {% endif %}
                {% if bill.order_type %}
                 نوع الطلب: {{ bill.order_type }}<br>
                {% endif %} 
        </div>
      </div>
    </div>
    
    <div class="invoice-details">
      <div class="invoice-number">فاتورة رقم: #{{bill.id}}-{{bill.ordernumber}}</div>
      
      <div class="date-section">
        <div class="date-item">
          <span class="date-label">تاريخ الطلب:</span>
          <span class="date-value"> {{ bill.created_at|date:"Y/m/d " }}</span>
        </div>
      </div>
    </div>
    
    <div class="divider"></div>
    
    <div class="items-section">
      <h2 class="section-title">المنتجات</h2>
      
      <table class="pricing-table">
        <thead>
          <tr>
            <th class="col-no">#</th>
            <th class="col-service">المنتج</th>
            <th class="col-quantity">الكمية</th>
            <th class="col-unit">سعر الوحدة</th>
            <th class="col-subtotal">المجموع</th>
          </tr>
        </thead>
        <tbody>

         {% for i in items %}

            <tr>
                <td class="row-number">{{ forloop.counter }}</td>
                <td class="service-name">{{ i.product.name }}{% if i.size %}{{ i.size }}المقاس:{% endif %}{% if i.color %}اللون:{{ i.color }}{% endif %}</td>
                <td class="quantity">{{ i.quantity }}</td>
                <td class="unit-price">{{ i.product.price }} د.ل</td>
                <td class="subtotal">{{ i.get_final_price }} د.ل</td>
            </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    
    <div class="total-section">
      <div class="total-box">
        {% if bill.notes %}
        <div class="total-row">
          <span class="total-label"> ملاحظات:</span>
          <span class="total-value">{{ bill.notes }}</span>
        </div>
        {% endif %}

        {% if bill.delivery_address %}
        <div class="total-row">
          <span class="total-label"> توصيل:</span>
          <span class="total-value">{{bill.delivery_address.price}} <span class="currency">د.ل</span></span>
        </div>
        {% elif bill.company_delivery_city %}
        <div class="total-row">
          <span class="total-label"> توصيل:</span>
          <span class="total-value">{{bill.company_delivery_price}} <span class="currency">د.ل</span></span>
        </div>        
        
        {% endif %}
        <div class="total-row total-amount">
          <span class="total-label">المبلغ الإجمالي:</span>
          <span class="total-value">{{bill.get_total}}<span class="currency">د.ل</span></span>
        </div>
      </div>
    </div>
    
    <div class="invoice-footer">
      <div>© 2026 {{bill.menu.customer.store_ar_name}} </div>
    </div>
    
  </div>
  
  <div class="controls">
    <button class="btn btn-print" onclick="window.print()">
      طباعة الفاتورة
    </button>
    <a href="{% url 'customer_dashboard' %}" class="back-btn">← العودة  </a>
 
  </div>

  <script>
    window.onload = function() {
      const printBtn = document.querySelector('.btn-print');
      if (printBtn) {
        printBtn.addEventListener('click', function() {
          setTimeout(() => {
            window.print();
          }, 100);
        });
      }
    };
  </script>
</body>
</html>